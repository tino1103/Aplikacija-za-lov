{"ast":null,"code":"var _jsxFileName = \"/Users/valentinodenona/Desktop/REACT4/Aplikacija-za-lov/src/pages/UnosLuLov.js\",\n  _s = $RefreshSig$();\n// unos.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from \"react-router-dom\";\nimport Webcam from 'react-webcam';\nimport jsQR from 'jsqr';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction DataEntryForm() {\n  _s();\n  const [brojLovackeIskaznice, setBrojLovackeIskaznice] = useState('');\n  const [message, setMessage] = useState('');\n  const navigate = useNavigate();\n  const webcamRef = useRef(null);\n  const [qrScanned, setQrScanned] = useState(false);\n\n  // Constraints to use the rear-facing camera\n  const videoConstraints = {\n    facingMode: {\n      exact: \"environment\"\n    }\n  };\n  useEffect(() => {\n    const interval = setInterval(() => {\n      if (!qrScanned) {\n        captureAndSubmit();\n      }\n    }, 1000); // Capture every second\n\n    return () => clearInterval(interval); // Cleanup\n  }, [qrScanned]);\n  const captureAndSubmit = () => {\n    const imageSrc = webcamRef.current.getScreenshot();\n    if (imageSrc) {\n      const image = new Image();\n      image.src = imageSrc;\n      image.onload = () => {\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        canvas.width = image.width;\n        canvas.height = image.height;\n        context.drawImage(image, 0, 0, canvas.width, canvas.height);\n        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n        const qrCode = jsQR(imageData.data, imageData.width, imageData.height, {\n          inversionAttempts: 'dontInvert'\n        });\n        if (qrCode) {\n          const currentTime = Date.now();\n          const scannedCodes = JSON.parse(localStorage.getItem('scannedCodes')) || {};\n          const lastScanned = scannedCodes[qrCode.data];\n          if (!lastScanned || currentTime - lastScanned > 6000) {\n            // 1 hour = 3600000 milliseconds\n            setBrojLovackeIskaznice(qrCode.data);\n            scannedCodes[qrCode.data] = currentTime;\n            localStorage.setItem('scannedCodes', JSON.stringify(scannedCodes));\n            submitForm(qrCode.data);\n          } else {\n            setMessage('Ovaj QR kod je već skeniran u posljednjoj minuti.');\n          }\n        } else {\n          setMessage('Nema QR koda u vidnom polju');\n        }\n      };\n    }\n  };\n  const submitForm = brojLovackeIskaznice => {\n    const userData = {\n      broj_lovacke_iskaznice: brojLovackeIskaznice\n    };\n    const token = localStorage.getItem('token');\n    const config = {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    };\n    axios.post('https://c1ea478869cf.ngrok.app/unos-osobe-u-lov', userData, config).then(response => {\n      alert('Osoba je dodana u prisutnost.');\n      setQrScanned(true); // Prevent further scanning\n      navigate(\"/popis-prisutnosti\");\n    }).catch(error => {\n      console.error('There was an error!', error);\n      setMessage(`Error: ${error.message}`);\n    });\n  };\n  const formStyle = {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center',\n    margin: '50px',\n    padding: '20px',\n    borderRadius: '8px',\n    boxShadow: '0 4px 8px rgba(0,0,0,0.1)',\n    backgroundColor: '#f7f7f7'\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '100vh',\n      backgroundColor: '#eee'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      style: formStyle,\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        style: {\n          color: '#333'\n        },\n        children: \"Unos osobe u lov\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Webcam, {\n        audio: false,\n        ref: webcamRef,\n        screenshotFormat: \"image/jpeg\",\n        videoConstraints: videoConstraints,\n        style: {\n          width: '100%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 9\n  }, this);\n}\n_s(DataEntryForm, \"eWQx82/00kKwZnEUyqdLP7agU+A=\", false, function () {\n  return [useNavigate];\n});\n_c = DataEntryForm;\nexport default DataEntryForm;\nvar _c;\n$RefreshReg$(_c, \"DataEntryForm\");","map":{"version":3,"names":["React","useState","useRef","useEffect","axios","useNavigate","Webcam","jsQR","jsxDEV","_jsxDEV","DataEntryForm","_s","brojLovackeIskaznice","setBrojLovackeIskaznice","message","setMessage","navigate","webcamRef","qrScanned","setQrScanned","videoConstraints","facingMode","exact","interval","setInterval","captureAndSubmit","clearInterval","imageSrc","current","getScreenshot","image","Image","src","onload","canvas","document","createElement","context","getContext","width","height","drawImage","imageData","getImageData","qrCode","data","inversionAttempts","currentTime","Date","now","scannedCodes","JSON","parse","localStorage","getItem","lastScanned","setItem","stringify","submitForm","userData","broj_lovacke_iskaznice","token","config","headers","post","then","response","alert","catch","error","console","formStyle","display","flexDirection","alignItems","justifyContent","margin","padding","borderRadius","boxShadow","backgroundColor","style","children","color","fileName","_jsxFileName","lineNumber","columnNumber","audio","ref","screenshotFormat","_c","$RefreshReg$"],"sources":["/Users/valentinodenona/Desktop/REACT4/Aplikacija-za-lov/src/pages/UnosLuLov.js"],"sourcesContent":["// unos.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from \"react-router-dom\";\nimport Webcam from 'react-webcam';\nimport jsQR from 'jsqr';\n\nfunction DataEntryForm() {\n    const [brojLovackeIskaznice, setBrojLovackeIskaznice] = useState('');\n    const [message, setMessage] = useState('');\n    const navigate = useNavigate();\n    const webcamRef = useRef(null);\n    const [qrScanned, setQrScanned] = useState(false);\n\n    // Constraints to use the rear-facing camera\n    const videoConstraints = {\n        facingMode: { exact: \"environment\" }\n    };\n\n    useEffect(() => {\n        const interval = setInterval(() => {\n            if (!qrScanned) {\n                captureAndSubmit();\n            }\n        }, 1000); // Capture every second\n\n        return () => clearInterval(interval); // Cleanup\n    }, [qrScanned]);\n\n    const captureAndSubmit = () => {\n        const imageSrc = webcamRef.current.getScreenshot();\n        if (imageSrc) {\n            const image = new Image();\n            image.src = imageSrc;\n            image.onload = () => {\n                const canvas = document.createElement('canvas');\n                const context = canvas.getContext('2d');\n                canvas.width = image.width;\n                canvas.height = image.height;\n                context.drawImage(image, 0, 0, canvas.width, canvas.height);\n                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n                const qrCode = jsQR(imageData.data, imageData.width, imageData.height, {\n                    inversionAttempts: 'dontInvert',\n                });\n                if (qrCode) {\n                    const currentTime = Date.now();\n                    const scannedCodes = JSON.parse(localStorage.getItem('scannedCodes')) || {};\n                    const lastScanned = scannedCodes[qrCode.data];\n\n                    if (!lastScanned || currentTime - lastScanned > 6000) { // 1 hour = 3600000 milliseconds\n                        setBrojLovackeIskaznice(qrCode.data);\n                        scannedCodes[qrCode.data] = currentTime;\n                        localStorage.setItem('scannedCodes', JSON.stringify(scannedCodes));\n                        submitForm(qrCode.data);\n                    } else {\n                        setMessage('Ovaj QR kod je već skeniran u posljednjoj minuti.');\n                    }\n                } else {\n                    setMessage('Nema QR koda u vidnom polju');\n                }\n            };\n        }\n    };\n\n    const submitForm = (brojLovackeIskaznice) => {\n        const userData = {\n            broj_lovacke_iskaznice: brojLovackeIskaznice\n        };\n\n        const token = localStorage.getItem('token');\n\n        const config = {\n            headers: {\n                'Authorization': `Bearer ${token}`\n            }\n        };\n\n        axios.post('https://c1ea478869cf.ngrok.app/unos-osobe-u-lov', userData, config)\n            .then(response => {\n                alert('Osoba je dodana u prisutnost.');\n                setQrScanned(true); // Prevent further scanning\n                navigate(\"/popis-prisutnosti\");\n            })\n            .catch(error => {\n                console.error('There was an error!', error);\n                setMessage(`Error: ${error.message}`);\n            });\n    };\n\n    const formStyle = {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        margin: '50px',\n        padding: '20px',\n        borderRadius: '8px',\n        boxShadow: '0 4px 8px rgba(0,0,0,0.1)',\n        backgroundColor: '#f7f7f7'\n    };\n\n    return (\n        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh', backgroundColor: '#eee' }}>\n            <form style={formStyle}>\n                <h1 style={{ color: '#333' }}>Unos osobe u lov</h1>\n                <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    videoConstraints={videoConstraints}\n                    style={{ width: '100%' }}\n                />\n                <p>{message}</p>\n            </form>\n        </div>\n    );\n}\n\nexport default DataEntryForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}